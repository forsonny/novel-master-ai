---
description: Guide for using Novel Master to manage end-to-end novel development workflows
globs: **/*
alwaysApply: true
---

# Novel Master Novel-Development Workflow

This guide tells you, the AI agent, how to drive a **full novel-writing loop** with Novel Master.
All examples assume the project already uses the **Narrative Workflow Extension**: NRDs, story-arc tasks, chapter/scene beats, and manuscript files.

Your primary job is to:
- Turn a **Novel Requirements Document (NRD)** into a coherent **tagged task outline** (acts → chapters → scenes/beats).
- Orchestrate **pacing, POV, and revision passes** via tasks and tags.
- Keep the **manuscript files** and **tasks.json** in sync.

---

## Core Mental Model

- **NRD (Novel Requirements Document)**: Outline + act structure + character sheets + world rules.
- **Tasks**:
  - **Top-level tasks** ≈ acts/major arcs or chapters.
  - **Subtasks** ≈ scenes, beats, or revision passes for that act/chapter.
- **Tags**:
  - `outline`: planning and structural work.
  - `draft`: first-pass drafting of chapters/scenes.
  - `rev-1`, `rev-2`, …: revision passes.
  - `beta-feedback`: tasks tracking external reader notes.
  - `character-<name>`, `timeline-<period>`: focused passes.
- **Manuscript files** (generated by `generate`):
  - Chapter/scene markdown packets under `.novelmaster/manuscript/chapters/`.
  - Compiled manuscript(s) under `.novelmaster/manuscript/compiled/`.

When unsure which tag to use, default to **`outline` → `draft` → `rev-1`** as the standard progression.

---

## High-Level Novel Loop

The canonical loop you should drive is:

1. **Capture / refine the NRD**
   - Work with the user to create or refine an NRD in `.novelmaster/docs/` (or another path they choose).
   - Ensure it includes: premise, act structure, character list, POV plan, tone/genre, and known constraints.

2. **Parse NRD → Outline tasks**
   - Tool/command: `parse_prd` MCP tool or `novel-master parse-prd <nrd-file> --tag=outline`.
   - Goal: produce top-level tasks for arcs/chapters with subtasks only where the NRD is already granular.
   - If multiple NRDs exist (e.g., main story + subplot), parse each into either:
     - Separate tags (`outline-main`, `outline-subplot`), or
     - A shared `outline` tag with clearly labeled titles.

3. **Analyze narrative complexity**
   - Tool/command: `analyze_project_complexity` / `novel-master analyze-complexity --tag=outline --research`.
   - Use it to:
     - Identify overloaded acts/chapters (too many beats or stakes).
     - Detect thin areas (low complexity where more development is needed).
     - Get recommended beat counts and expansion prompts.

4. **Expand chapters into beats**
   - Tool/command: `expand_task` / `expand_all`.
   - Typical flows:
     - **Targeted**: `novel-master expand --id=<chapterId> --tag=outline --research`.
     - **Bulk**: `novel-master expand --all --tag=outline --research`.
   - Ask for:
     - Scene goals, emotional beats, conflict, and outcome.
     - POV and setting for each beat.
     - Hooks for later payoffs.

5. **Generate manuscript packets**
   - Tool/command: `generate` MCP tool or `novel-master generate --tag=draft`.
   - Maps:
     - Parent tasks → chapter markdown files.
     - Subtasks → sections/headings or inline beat comments inside each chapter.
   - After generation, you should:
     - Open relevant chapter files (via MCP resources/files) to reason about drafting.
     - Keep track of which chapters are **ready to draft** vs still structural.

6. **Drafting loop**
   - For each chapter/scene in `draft` tag:
     - Use `update_subtask` or direct file editing (via MCP tools/resources) to write prose for beats.
     - Keep the **task details** field aligned with what’s actually in the manuscript.
     - Use `set_task_status` to mark beats/chapters as `drafting`, `draft`, or `rev-1-ready`.

7. **Revision passes**
   - Create tags like:
     - `rev-1` (global first revision),
     - `rev-1-character-<name>` (POV/character-specific pass),
     - `rev-1-timeline-<period>` (timeline continuity).
   - For each pass:
     - Use `add-task` / `add-subtask` to create targeted revision tasks.
     - Use `research` for worldbuilding or factual checks.
     - Update manuscript files and corresponding tasks together.

8. **Beta feedback & polish**
   - Gather external feedback into `beta-feedback` tasks.
   - Use `update_task` / `update_subtask` to log notes and decisions.
   - Run a final **complexity + continuity review** using `analyze_project_complexity` and the `research` tool.
   - Re-generate or re-compile the manuscript as needed.

9. **Final compilation**
   - Use `generate` (or dedicated compile helpers when available) to produce a final `manuscript-<tag>.md`.
   - Ensure the final compile corresponds to a stable tag (e.g., `rev-2` or `release`) and that all relevant tasks for that tag are `done`.

---

## How to Choose Tools in Common Situations

### Starting a new novel from scratch

1. Ask the user for genre, length, POV strategy, and any must-have tropes.
2. Propose creating an NRD file (`.novelmaster/docs/nrd.txt` or `nrd.md`).
3. Help draft the NRD itself.
4. Run `parse_prd` into `outline`.
5. Immediately follow with `analyze_project_complexity` → `expand_all`.
6. Once outline feels solid, run `generate` to create manuscript chapter packets into `draft`.

### Continuing an existing manuscript

1. Discover context:
   - Use `get_tasks` / `novel-master list` to see existing tags and tasks.
   - Inspect `.novelmaster/manuscript/` for existing chapters.
2. Ask the user which **phase** they are in:
   - Still outlining, drafting, first revision, or polishing.
3. Map that phase to a tag and work **only in that tag** unless told otherwise.
4. Use `get_task` and chapter files to align tasks with existing prose before adding new beats.

### Handling structural changes mid-draft

When the user changes a major story decision (e.g., new protagonist, different ending):

1. Use `update` (batch) or `update_task` (single) on outline tasks to realign structure.
2. Use tags to separate the old vs new plan, e.g.:
   - Keep old structure in `outline-v1`.
   - Create revised outline in `outline-v2` and point new work there.
3. Clearly mark obsolete tasks as `deferred` or move them into an archival tag.
4. When rewriting chapters, coordinate:
   - `update_task` / `update_subtask` for the plan.
   - Direct manuscript edits for the prose.

---

## Tagging Strategy (Short Reference)

Use tags to express **phase** and **focus area**:

- **Phase tags** (mutually exclusive for a given chapter at a time):
  - `outline`, `draft`, `rev-1`, `rev-2`, `release`.
- **Focus tags** (can coexist):
  - `beta-feedback`, `character-<name>`, `timeline-<period>`, `worldbuilding-<topic>`.

Agent behavior:
- Default to **`outline`** when parsing/expanding NRDs.
- Default to **`draft`** when generating prose/manuscript files.
- Default to **`rev-1`** when asked for a “first full revision pass”.
- Propose **new tags** if the user describes a focused pass (“just tighten pacing in Act II” → `rev-1-pacing-act-2`).

---

## MCP vs CLI Usage

- Prefer **MCP tools** (`parse_prd`, `analyze_project_complexity`, `expand_task`, `expand_all`, `research`, `generate`, etc.) when acting as an AI agent.
- Fall back to CLI (`novel-master ...`) only when:
  - A feature is not yet exposed as MCP, or
  - You need to reference CLI output patterns from the docs.
- Always keep tools **idempotent** in your workflows: it should be safe to re-run `parse_prd`, `expand_task`, or `generate` if something partially failed.

When in doubt, consult [`taskmaster.mdc`](mdc:.cursor/rules/taskmaster.mdc) (Novel Master tool reference) for exact tool/command signatures and narrative examples.

