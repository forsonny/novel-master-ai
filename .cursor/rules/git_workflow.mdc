---
description: Git workflow for manuscripts and Novel Master tags (drafts, revisions, and releases)
globs: "**/*"
alwaysApply: true
---

# Git & Manuscript Workflow with Novel Master

This rule describes how to combine **Git** with Novel Master’s **tagged task lists** and **manuscript files**.
Treat Git as the source of truth for your **NRDs, tasks.json, and manuscript markdown**, not just code.

---

## Branch Strategy for Novels

### Main Branch

- `main` (or `master`) should contain the **current canonical version** of the novel:
  - The authoritative NRD(s).
  - The current best outline (`outline` tag).
  - The current accepted manuscript draft (often `rev-1` or `release`).
- Avoid experimenting directly on `main`; use branches and tags.

### Recommended Branch Types

Use descriptive names that reflect **story work**, not implementation details:

```bash
# Draft phases
draft-v1           # First complete draft pass
draft-v2           # Second draft (after major structural changes)

# Revision phases
rev-1-structure    # Global structural revision
rev-1-character-lena
rev-1-timeline-war

# Experiments
experiment-alt-ending
experiment-dual-pov
```

You can mirror these branches with Novel Master tags (`rev-1-character-lena`, `experiment-alt-ending`, etc.).

---

## Tagged Task Lists Integration

Novel Master’s **tagged tasks** give you per-branch story contexts:

- **Branch-specific tags**:
  - On branch `draft-v1`, use tags like `draft` and `rev-1` to represent the state of the draft.
  - On branch `experiment-alt-ending`, use tag `experiment-alt-ending` for alternate outline + manuscript work.
- **Merge conflict prevention**:
  - Different branches + tags keep experimental structures separate from the canonical one.
  - Only merge back into `main` once a branch’s outline/manuscript is approved.

### Typical Flow: New Revision Pass

1. Start from the branch that holds the current accepted draft:

```bash
git checkout main
git pull origin main
git checkout -b rev-1-structure
```

2. In this branch, create or use a tag for the pass:

```bash
novel-master use-tag rev-1
# or
novel-master add-tag rev-1-structure --description="Global structural revision"
```

3. Add revision tasks (e.g. tightening pacing, fixing plot holes) under that tag.
4. Update both the **tasks** and **manuscript files** as you work.
5. When satisfied, merge `rev-1-structure` back to main, resolving conflicts in:
   - `.novelmaster/tasks/tasks.json`
   - `.novelmaster/manuscript/**`
   - `.novelmaster/docs/**` (NRDs, notes)

---

## Full Workflow Example

### Phase 1: Outline on a Feature Branch

```bash
# 1. Start from main
git checkout main
git pull origin main

# 2. Create an outline branch for a new novel or major rewrite
git checkout -b outline-v2

# 3. Create/update NRD and commit it
novel-master parse-prd .novelmaster/docs/nrd-v2.txt --tag=outline-v2
git add .novelmaster/docs/nrd-v2.txt .novelmaster/tasks/tasks.json
git commit -m "feat(outline-v2): Parse NRD v2 into outline-v2 tag"
```

### Phase 2: Drafting

```bash
# 4. Generate manuscript chapter packets for draft
novel-master generate --tag=draft

git add .novelmaster/manuscript/
git commit -m "feat(draft-v1): Generate initial chapter packets from outline-v2"
```

### Phase 3: Revision Branch

```bash
# 5. Branch off for first revision
git checkout -b rev-1-character-lena

# 6. Use revision tag for character-focused tasks
novel-master add-tag rev-1-character-lena --description="Revise Lena POV and arc"

# 7. Add and complete revision tasks, updating manuscript chapters
novel-master add-task --tag=rev-1-character-lena \
  --prompt="Strengthen Lena's agency and emotional arc in chapters 3, 7, and 10."

git add .novelmaster/tasks/tasks.json .novelmaster/manuscript/
git commit -m "feat(rev-1-character-lena): First pass on Lena's POV arc"
```

### Phase 4: Merge Back

```bash
# 8. Merge revision branch into main once approved
git checkout main
git pull origin main
git merge rev-1-character-lena

# 9. Resolve any conflicts in tasks.json or manuscript files
git push origin main
```

---

## Commit Message Patterns (Novel-Focused)

Use commits to clearly record **what changed in the story**, not only the files.

### Outline / Task Changes

```bash
git commit -m "feat(outline): Add Act II midpoint reversal and fallout

- Added tasks for new betrayal sequence in chapter 12
- Updated dependencies so chapter 13 reflects new status quo
- Marked old confrontation scene as deferred
"
```

### Manuscript Drafting

```bash
git commit -m "feat(draft-v1): Draft chapter 7 - The Glass Market

- Wrote first-pass prose for chapter 7 based on outline beats
- Established stronger sense of place in the orbital bazaar
- Ended scene on a clear turning point for Mina's arc
"
```

### Revision Passes

```bash
git commit -m "feat(rev-1-structure): Tighten Act I pacing

- Cut redundant exposition in chapters 1–2
- Moved inciting incident earlier into chapter 1
- Updated outline tasks and dependencies to match new structure
"
```

---

## Agent Checklist for Git + Novel Master

When the user mentions Git, branches, or releases:

1. **Identify phase**: Are we outlining, drafting, revising, or packaging a release?
2. **Align branch + tag**:
   - Suggest a branch name that matches the phase (`draft-v1`, `rev-1-structure`, etc.).
   - Suggest a matching Novel Master tag if necessary.
3. **Keep files and tasks together**:
   - Always commit NRDs, `tasks.json`, and manuscript files in the same logical change.
4. **Avoid mixing experiments with canon**:
   - Use `experiment-*` branches and tags for alternate endings, POV experiments, or radical rewrites.
5. **Treat releases like book editions**:
   - Use tags/branches like `release-v1`, `release-v1-ebook`, etc., and ensure the compiled manuscript matches that state.

