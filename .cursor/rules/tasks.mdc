---
description: Story arc, chapter, and scene task patterns for Novel Master
globs: scripts/modules/task-manager.js
alwaysApply: false
---

# Story Task Structure Guidelines

This rule defines how **tasks** and **subtasks** should be used to represent **story structure** in Novel Master.
Treat tasks as the **spine of the novel** (acts, arcs, chapters, scenes, beats, revisions), not as code tickets.

---

## Narrative Task Hierarchy

- **Top-level tasks**:
  - Represent **acts**, major **story arcs**, or occasionally **chapters**.
  - Examples:
    - `Act I – Arrival at the Glass Orbit`
    - `Lena's Redemption Arc`
    - `Chapter 7 – The Bazaar Riot`
- **Subtasks**:
  - Represent **scenes** or **beats** within those arcs/chapters.
  - Can also represent **revision passes** on a specific chapter or sequence.

You can mix both approaches in a single project:

- Some top-level tasks are arcs with scene subtasks.
- Others are direct chapter tasks with scene or revision subtasks.

---

## Standard Task Fields (Narrative)

Every task in `tasks.json` should follow this conceptual shape:

```json
{
  "id": 7,
  "title": "Chapter 7 – The Bazaar Riot",
  "description": "Protagonist's first major public failure; stakes of rebellion escalate.",
  "status": "pending",
  "dependencies": [5, 6],
  "priority": "high",
  "details": "POV: Mina.\nSetting: Glass Orbit bazaar at dusk.\nGoal: Secure counterfeit passes.\nOpposition: Station security & hidden saboteur.\nEmotional target: fear → humiliation → grim resolve.\nForeshadow: hint at traitor in Lena's cell.\nResearch hooks: crowd control tactics, zero-g market layouts.",
  "testStrategy": "Check continuity with chapter 6 (arrival) and chapter 8 (aftermath).\nVerify that Mina's arc shifts plausibly from naivety to hardened resolve.\nEnsure worldbuilding rules (gravity, security tech) are applied consistently.",
  "subtasks": [
    {
      "id": 1,
      "title": "Opening beat – Crowded market and rising tension",
      "description": "Mina navigates the market; subtle signs of unrest.",
      "status": "pending",
      "dependencies": [],
      "details": "Introduce sensory details and establish layout of the bazaar.",
      "testStrategy": "Ensure the geography matches later chase beats; POV is tight third."
    }
  ]
}
```

Key narrative uses:

- `title` → clearly identifies act/chapter or scene name.
- `description` → one-sentence story function.
- `details` → rich narrative brief (POV, tone, setting, sensory prompts, research hooks).
- `testStrategy` → how to \"test\" this story unit for consistency (continuity, character arc, pacing).

---

## ID & Tag Conventions

- **IDs**:
  - Still simple integers (`1`, `2`, `3`, …) for tasks.
  - Subtasks use dotted notation when referred to externally (`7.1`, `7.2`), but store numeric `id` under the parent.
- **Tags**:
  - Use tags to separate **phases** and **focus passes**:
    - `outline` – structural planning.
    - `draft` – first-pass prose.
    - `rev-1` – first global revision.
    - `character-<name>` – character-specific passes.
    - `timeline-<period>` – timeline/continuity passes.
  - Internally, tasks live under `{"<tag>": { "tasks": [...] }}` in `tasks.json`.

Core functions should always:

- Resolve the current tag (`getCurrentTag(projectRoot) || 'master'`).
- Read/write through tag helpers (see `tags.mdc` for patterns).

---

## Task Creation from NRDs

When parsing NRDs with `parse_prd`:

- **Top-level tasks** usually map to:
  - Acts (Three-Act, Four-Act, Hero’s Journey stages), or
  - Major arcs (e.g., \"Rebellion arc\", \"Romance arc\").
- **Subtasks**:
  - Optional at this stage; often just the most important scenes called out in the NRD.

Best practices:

- Keep initial tasks **broad**; use `expand_task` later to add detailed beats.
- Preserve NRD constraints explicitly in `details` and `dependencies`:
  - \"This reveal must come after X\" → dependency.
  - \"Must foreshadow Y\" → part of `details`/`testStrategy`.

---

## Expansion into Scenes & Beats

`expand_task` and `expand_all` should:

- Turn broad chapter/arc tasks into **ordered scene/beat subtasks**.
- Add narrative-specific metadata:
  - POV, setting, emotional state at start/end.
  - Beat type (action, reaction, reveal, decision).

Example subtask after expansion:

```json
{
  "id": 3,
  "title": "Climax of bazaar riot – Mina chooses to save strangers",
  "description": "Mina sacrifices her escape route to save trapped vendors.",
  "status": "pending",
  "dependencies": [1, 2],
  "details": "POV: Mina.\nEmotion: terror → empathy → determination.\nBeat purpose: lock in new moral commitment; raise cost of rebellion.",
  "testStrategy": "Verify choice feels earned based on prior scenes; ensure consequences ripple into next chapter."
}
```

---

## Revision Tasks

For revision passes (`rev-1`, `rev-2`, etc.), treat tasks as **slices across the manuscript**:

- A revision task might span many chapters:
  - \"Tighten early exposition in chapters 1–3.\"
  - \"Clarify magic system limitations wherever used.\"
- Subtasks can then target specific scenes:
  - \"Cut repeat explanation in chapter 2, scene 3.\"
  - \"Adjust spell costs in chapter 5 duel.\"

In these tasks:

- `details` should describe **what to change and why**, not re-outline the plot from scratch.
- `testStrategy` should specify how to confirm the change works (e.g., reread sequence, compare before/after stakes).

---

## Agent Responsibilities

When you create or modify tasks:

- Keep `title` and `description` **short and clear**; keep prose and nuance in `details`.
- Always consider **character and thematic arcs**, not just plot events.
- Use `testStrategy` to encode how to validate the story change, not automated code tests.
- Align task structure with the user’s preferred outline model (three-act, Hero’s Journey, etc.), as seen in the NRD.

See [`taskmaster.mdc`](mdc:.cursor/rules/taskmaster.mdc) for concrete MCP tool/command mappings, and [`dev_workflow.mdc`](mdc:.cursor/rules/dev_workflow.mdc) for how these tasks fit into the full novel loop.

