---
description: Narrative quality, continuity, and pacing checks for Novel Master projects
globs: 
alwaysApply: true
---

# Narrative \"Testing\" Workflow

This rule replaces code-centric TDD/Jest guidance with **story-quality checks** for novels.
You, the AI agent, should treat \"testing\" as systematically checking:

- **Continuity** (timeline, facts, world rules).
- **Character consistency** (voice, motivation, arcs).
- **POV and tense** consistency.
- **Pacing and structure** (scene lengths, act turns, climaxes).

You do **not** set up Jest or run unit tests here; instead you use Novel Master tools plus reading and analysis of NRDs and manuscript files.

---

## Where Narrative Tests Live

Use a combination of:

- **Tasks & tags**:
  - Create tasks specifically for checks: \"Continuity pass for Act II\", \"POV consistency for Mina\", etc.
  - Group them under tags like `rev-1`, `rev-2`, `beta-feedback`.
- **Reports**:
  - Use `analyze_project_complexity` outputs as structured reports on pacing and complexity.
  - Save custom analysis notes under `.novelmaster/reports/` or as tasks’ `details`.
- **Manuscript annotations**:
  - For some flows, you may embed TODO-style comments or headings in chapter files for manual review.

---

## Core Narrative Check Types

### 1. Continuity & Timeline

What to check:

- Event order: does the sequence of events make sense?
- Time jumps: are time skips consistent and clearly signaled?
- World rules: are magic/technology/politics used consistently?

How to do it:

1. Gather context:
   - Use the `research` tool with tasks + chapter files as context, or operate on compiled manuscript.
2. Ask yourself:
   - Are there any contradictions in dates, travel times, or cause/effect?
   - Do subplots intersect cleanly at key points?
3. Capture findings:
   - Create or update tasks tagged `rev-1-timeline-<period>` for specific timeline fixes.
   - Use `update_subtask` to append continuity notes to affected beats.

### 2. Character Consistency

What to check:

- Voice: does each POV character sound distinct and stable?
- Motivation: do actions follow from established wants and fears?
- Arc: does each major character change over time in a coherent way?

How to do it:

1. For each major character, create a tag: `character-<name>`.
2. Use `get_tasks` filtered by that tag and inspect corresponding chapters/scenes.
3. Use `research` (with tasks + chapters) to ask for:
   - A summary of the character’s journey.
   - Any scenes where the character acts \"out of character\".
4. Turn issues into tasks in `rev-1` or `rev-2` tagged contexts for later fixes.

### 3. POV & Tense Consistency

What to check:

- Does the story stick to its intended POV strategy (e.g., limited third for Mina, alternating first-person chapters)?
- Are POV switches clear and motivated?
- Is tense (past vs present) steady except where intentionally varied?

How to do it:

1. Use `generate` to ensure chapters clearly mark POV in their metadata or headings.
2. Use `research` with chapter files to ask:
   - \"List all chapters and their POV/tense; flag inconsistencies or unexplained switches.\"
3. Create tasks for each needed adjustment, tagged `rev-1-pov` or similar.

### 4. Pacing & Structure

What to check:

- Are there long stretches with no meaningful change?
- Do key structural beats (inciting incident, midpoint, climax) land at plausible positions?
- Is the balance between scene and sequel (action vs reflection) healthy?

How to do it:

1. Run `analyze_project_complexity` against the relevant tag (often `outline` or `draft`).
2. Inspect the resulting report:
   - Look for chapters/arcs with unusually high or low complexity scores.
3. Use `expand_task` or `expand_all` to reshape beats:
   - Add more beats to thin sections.
   - Merge or cut beats in bloated sections.
4. Create dedicated tasks (e.g. \"Tighten Act I pacing\", \"Slow down Act III emotional fallout\") under `rev-1-structure`.

---

## Suggested Narrative Test Suite

For a typical novel, encourage the user to run these \"test passes\":

1. **Structure pass (outline-level)**:
   - Tools: `parse_prd`, `analyze_project_complexity`, `expand_all`.
   - Output: clean, reasonably balanced outline tasks.
2. **Continuity pass (timeline)**:
   - Tools: `research` on compiled manuscript + timeline-tagged tasks.
   - Output: tasks for fixing contradictions and clarifying time jumps.
3. **Character-pass (per POV/major character)**:
   - Tools: `research` scoped to `character-<name>` tags and related chapters.
   - Output: tasks to adjust arcs, motivations, and voice.
4. **Pacing & emotional arc pass**:
   - Tools: `analyze_project_complexity` + manual reading of key sequences.
   - Output: tasks to add/remove/reshape beats for better momentum.
5. **Beta-feedback integration pass**:
   - Collect notes into `beta-feedback` tasks.
   - Translate each major note into actionable `rev-2` tasks.

---

## How to Talk About Narrative Quality with the User

When the user says things like:

- \"The middle drags.\" → Suggest a **pacing/structure pass** on Act II, create tasks, run complexity analysis.
- \"I’m not sure Mina’s arc is landing.\" → Suggest a **character pass** for Mina with dedicated tag, analyze beats, create revision tasks.
- \"Readers were confused about the timeline.\" → Run a **continuity pass** and propose timeline-specific tasks and tags.

In all cases, be explicit about:

- Which **tag** you are working in (e.g., `rev-1`, `rev-1-character-mina`).
- Which **tools** you will call (`analyze_project_complexity`, `research`, `expand_task`, `generate`).
- What **artifact** will illustrate the result (report file, updated tasks, revised chapter files).

