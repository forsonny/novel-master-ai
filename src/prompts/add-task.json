{
	"id": "add-task",
	"version": "1.0.0",
	"description": "Generate a new narrative task (chapter/scene/story arc) based on description",
	"metadata": {
		"author": "system",
		"created": "2024-01-01T00:00:00Z",
		"updated": "2024-01-01T00:00:00Z",
		"tags": ["narrative-creation", "chapter-generation", "scene-planning"]
	},
	"parameters": {
		"prompt": {
			"type": "string",
			"required": true,
			"description": "NRD-style description of the narrative beat/chapter/scene to create"
		},
		"newTaskId": {
			"type": "number",
			"required": true,
			"description": "ID for the new task"
		},
		"existingTasks": {
			"type": "array",
			"description": "List of existing tasks for context"
		},
		"gatheredContext": {
			"type": "string",
			"description": "Context gathered from manuscript analysis (existing chapters, scenes, character arcs)"
		},
		"contextFromArgs": {
			"type": "string",
			"description": "Additional context from manual args"
		},
		"priority": {
			"type": "string",
			"default": "medium",
			"enum": ["high", "medium", "low"],
			"description": "Narrative priority (high = plot-critical, medium, low = optional vignette)"
		},
		"dependencies": {
			"type": "array",
			"description": "Prerequisite chapter/scene IDs that must be completed before this task"
		},
		"useResearch": {
			"type": "boolean",
			"default": false,
			"description": "Use research mode for genre/lore-aware task creation"
		},
		"hasManuscriptContext": {
			"type": "boolean",
			"required": false,
			"default": false,
			"description": "Whether manuscript context is available (manuscript files, prior drafts, research notes)"
		},
		"hasCodebaseAnalysis": {
			"type": "boolean",
			"required": false,
			"default": false,
			"description": "Deprecated: Use hasManuscriptContext instead. Whether manuscript context is available"
		},
		"projectRoot": {
			"type": "string",
			"required": false,
			"default": "",
			"description": "Project root path for context"
		}
	},
	"prompts": {
		"default": {
			"system": "You are a helpful assistant that creates well-structured narrative tasks (chapters/scenes) for a novel project. Generate a single new task based on the user's description, adhering strictly to the provided JSON schema.\n\nIMPORTANT: Your response MUST be a JSON object with the following structure (no wrapper property, just these fields directly):\n{\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"details\": \"string\",\n  \"testStrategy\": \"string\",\n  \"dependencies\": [array of numbers]\n}\n\nDo not include any other top-level properties. Do NOT wrap this in any additional object.\n\nPay special attention to dependencies between tasks, ensuring the new task correctly references any tasks it depends on.\n\nWhen determining dependencies for a new task, follow these principles:\n1. Select dependencies based on narrative requirements - what story elements must be established before this task can begin.\n2. Prioritize task dependencies that are semantically related to the story arc or plot thread being developed.\n3. Consider both direct dependencies (immediately prerequisite scenes/chapters) and indirect dependencies.\n4. Avoid adding unnecessary dependencies - only include tasks that are genuinely prerequisite to the narrative flow.\n5. Consider the current status of tasks - prefer completed tasks as dependencies when possible.\n6. Pay special attention to foundation tasks (1-5) but don't automatically include them without reason.\n7. Recent tasks (higher ID numbers) may be more relevant for newer story developments.\n\nThe dependencies array should contain task IDs (numbers) of prerequisite tasks.{{#if useResearch}}\n\nResearch genre conventions, narrative techniques, and storytelling approaches relevant to this task.{{/if}}",
			"user": "{{#if (or hasManuscriptContext hasCodebaseAnalysis)}}## IMPORTANT: Manuscript Context Available\n\nYou have access to manuscript files and project context. Before generating the task:\n\n1. Use the Glob tool to explore the manuscript structure (e.g., \".novelmaster/**/*.md\", \".novelmaster/docs/**\", \".novelmaster/manuscript/**\")\n2. Use the Grep tool to search for existing scenes, character references, and plot threads\n3. Use the Read tool to examine key files like NRD documents, chapter files, and research notes\n4. Analyze the current manuscript to understand what story elements already exist\n\nBased on your analysis:\n- Identify existing chapters/scenes/character arcs that relate to this new task\n- Understand the story's tone, POV structure, and narrative patterns in use\n- Generate narrative details that align with the project's established story structure\n- Reference specific chapters, scenes, or story elements from the manuscript in your details\n\nProject Root: {{projectRoot}}\n\n{{/if}}You are generating the details for Task #{{newTaskId}}. Based on the user's request: \"{{prompt}}\", create a comprehensive new narrative task (chapter/scene) for a novel project.\n      \n      {{gatheredContext}}\n      \n      {{#if useResearch}}Research genre conventions, narrative techniques, and effective storytelling approaches relevant to this task. {{/if}}Based on the information about existing tasks provided above, include appropriate dependencies in the \"dependencies\" array. Only include task IDs that this new task directly depends on.\n      \n      Return your answer as a single JSON object matching the schema precisely:\n      \n      {\n        \"title\": \"Task title goes here\",\n        \"description\": \"A concise one or two sentence description of what the task involves\",\n    \"details\": \"Detailed scene development steps, narrative considerations, character moments, or storytelling approach\",\n    \"testStrategy\": \"Specific steps to verify continuity, pacing, and narrative consistency\",\n    \"dependencies\": [1, 3] // Example: IDs of tasks that must be completed before this task\n  }\n      \n      Make sure the details and test strategy are comprehensive and specific{{#if useResearch}}, incorporating effective narrative techniques from your research{{/if}}. DO NOT include the task ID in the title.\n      {{#if contextFromArgs}}{{contextFromArgs}}{{/if}}"
		}
	}
}
