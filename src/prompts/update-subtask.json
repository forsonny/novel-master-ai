{
	"id": "update-subtask",
	"version": "1.0.0",
	"description": "Append information to a scene/beat (subtask) by generating only new narrative content",
	"metadata": {
		"author": "system",
		"created": "2024-01-01T00:00:00Z",
		"updated": "2024-01-01T00:00:00Z",
		"tags": ["narrative-update", "scene-beat", "append", "progress-logging"]
	},
	"parameters": {
		"parentTask": {
			"type": "object",
			"required": true,
			"description": "The parent chapter context"
		},
		"prevSubtask": {
			"type": "object",
			"required": false,
			"description": "The previous scene/beat if any"
		},
		"nextSubtask": {
			"type": "object",
			"required": false,
			"description": "The next scene/beat if any"
		},
		"currentDetails": {
			"type": "string",
			"required": true,
			"default": "(No existing details)",
			"description": "Current subtask details"
		},
		"updatePrompt": {
			"type": "string",
			"required": true,
			"description": "User request for what to add"
		},
		"useResearch": {
			"type": "boolean",
			"default": false,
			"description": "Use research mode"
		},
		"gatheredContext": {
			"type": "string",
			"default": "",
			"description": "Additional project context"
		},
		"hasManuscriptContext": {
			"type": "boolean",
			"required": false,
			"default": false,
			"description": "Whether manuscript context is available (manuscript files, prior drafts, research notes)"
		},
		"hasCodebaseAnalysis": {
			"type": "boolean",
			"required": false,
			"default": false,
			"description": "Deprecated: Use hasManuscriptContext instead. Whether manuscript context is available"
		},
		"projectRoot": {
			"type": "string",
			"required": false,
			"default": "",
			"description": "Project root path for context"
		}
	},
	"prompts": {
		"default": {
			"system": "You are an AI assistant helping to update a subtask (scene/beat). You will be provided with the subtask's existing details, context about its parent chapter and sibling scenes, and a user request string.{{#if useResearch}} You have access to genre conventions, worldbuilding research, and narrative techniques to provide research-backed updates.{{/if}}\n\nYour Goal: Based *only* on the user's request and all the provided context (including existing details if relevant to the request), GENERATE the new text content that should be added to the subtask's details.\nFocus *only* on generating the substance of the update.\n\nOutput Requirements:\n1. Return *only* the newly generated text content as a plain string. Do NOT return a JSON object or any other structured data.\n2. Your string response should NOT include any of the subtask's original details, unless the user's request explicitly asks to rephrase, summarize, or directly modify existing text.\n3. Do NOT include any timestamps, XML-like tags, markdown, or any other special formatting in your string response.\n4. Ensure the generated text is concise yet complete for the update based on the user request. Avoid conversational fillers or explanations about what you are doing (e.g., do not start with \"Okay, here's the update...\").{{#if useResearch}}\n5. Include specific narrative techniques, genre conventions, and effective storytelling approaches relevant to the scene/beat.\n6. Provide research-backed narrative recommendations and proven writing techniques.{{/if}}",
			"user": "{{#if (or hasManuscriptContext hasCodebaseAnalysis)}}## IMPORTANT: Manuscript Context Available\n\nYou have access to manuscript files and project context. Before generating the subtask update:\n\n1. Use the Glob tool to explore the manuscript structure (e.g., \".novelmaster/**/*.md\", \".novelmaster/docs/**\", \".novelmaster/manuscript/**\")\n2. Use the Grep tool to search for existing scenes, character references, and plot threads\n3. Use the Read tool to examine relevant chapter files, NRD documents, and research notes\n4. Analyze the current manuscript to inform your subtask update\n\nBased on your analysis:\n- Include specific scene references, character moments, or plot connections\n- Ensure suggestions align with the story's established tone, POV, and world rules\n- Reference existing story elements or narrative patterns when relevant\n- Make scene development notes specific to the manuscript structure\n\nProject Root: {{projectRoot}}\n\n{{/if}}Task Context:\n\nParent Task: {{{json parentTask}}}\n{{#if prevSubtask}}Previous Subtask: {{{json prevSubtask}}}\n{{/if}}{{#if nextSubtask}}Next Subtask: {{{json nextSubtask}}}\n{{/if}}Current Subtask Details (for context only):\n{{currentDetails}}\n\nUser Request: \"{{updatePrompt}}\"\n\n{{#if useResearch}}Research and incorporate genre conventions, effective narrative techniques, and proven storytelling approaches into your update. {{/if}}Based on the User Request and all the Task Context (including current subtask details provided above), what is the new information or text that should be appended to this subtask's details? Return ONLY this new text as a plain string.{{#if useResearch}} Include specific narrative recommendations based on effective writing techniques.{{/if}}\n{{#if gatheredContext}}\n\n# Additional Project Context\n\n{{gatheredContext}}\n{{/if}}"
		}
	}
}
